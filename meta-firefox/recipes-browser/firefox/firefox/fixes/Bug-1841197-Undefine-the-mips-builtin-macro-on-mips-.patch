From: Mike Hommey <mh+mozilla@glandium.org>
Date: Fri, 30 Jun 2023 02:07:45 +0000
Subject: Bug 1841197 - Undefine the mips builtin macro on mips in skia.
 r=gfx-reviewers,lsalzman

Differential Revision: https://phabricator.services.mozilla.com/D182536
---
 gfx/skia/generate_mozbuild.py | 5 +++++
 gfx/skia/moz.build            | 5 +++++
 2 files changed, 10 insertions(+)

diff --git a/gfx/skia/generate_mozbuild.py b/gfx/skia/generate_mozbuild.py
index dbfcaf3..3a41946 100755
--- a/gfx/skia/generate_mozbuild.py
+++ b/gfx/skia/generate_mozbuild.py
@@ -99,6 +99,11 @@ if CONFIG['MOZ_WIDGET_TOOLKIT'] in ('gtk', 'android'):
 
 if CONFIG['MOZ_WIDGET_TOOLKIT'] == 'gtk':
     CXXFLAGS += CONFIG['MOZ_PANGO_CFLAGS']
+
+if CONFIG['CPU_ARCH'] in ('mips32', 'mips64'):
+    # The skia code uses `mips` as a variable, but it's a builtin preprocessor
+    # macro on mips that expands to `1`.
+    DEFINES['mips'] = False
 """
 
 import json
diff --git a/gfx/skia/moz.build b/gfx/skia/moz.build
index 445eac8..63c8e8a 100644
--- a/gfx/skia/moz.build
+++ b/gfx/skia/moz.build
@@ -610,3 +610,8 @@ if CONFIG['MOZ_WIDGET_TOOLKIT'] in ('gtk', 'android'):
 
 if CONFIG['MOZ_WIDGET_TOOLKIT'] == 'gtk':
     CXXFLAGS += CONFIG['MOZ_PANGO_CFLAGS']
+
+if CONFIG['CPU_ARCH'] in ('mips32', 'mips64'):
+    # The skia code uses `mips` as a variable, but it's a builtin preprocessor
+    # macro on mips that expands to `1`.
+    DEFINES['mips'] = False
