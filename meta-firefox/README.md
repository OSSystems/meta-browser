## Build and test status: 


### Glibc

| x | aarch64 | arm | riscv64 | x86-64 |
| ---- | ---- | ---- | ---- | ---- |
| Kirkstone - 140.3.1esr | ![](https://sarvari.me/meta-browser/badges/kirkstone/aarch64/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/kirkstone/aarch64/glibc/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/kirkstone/arm/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/kirkstone/arm/glibc/140.3.1esr/test) | N/A | ![](https://sarvari.me/meta-browser/badges/kirkstone/x86-64/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/kirkstone/x86-64/glibc/140.3.1esr/test) |
| Kirkstone - 143.0.4 | ![](https://sarvari.me/meta-browser/badges/kirkstone/aarch64/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/kirkstone/aarch64/glibc/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/kirkstone/arm/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/kirkstone/arm/glibc/143.0.4/test) | N/A | ![](https://sarvari.me/meta-browser/badges/kirkstone/x86-64/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/kirkstone/x86-64/glibc/143.0.4/test) |
| Scarthgap - 140.3.1esr | ![](https://sarvari.me/meta-browser/badges/scarthgap/aarch64/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/aarch64/glibc/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/scarthgap/arm/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/arm/glibc/140.3.1esr/test) |![](https://sarvari.me/meta-browser/badges/scarthgap/riscv/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/riscv/glibc/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/scarthgap/x86-64/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/x86-64/glibc/140.3.1esr/test) |
| Scarthgap - 143.0.4 | ![](https://sarvari.me/meta-browser/badges/scarthgap/aarch64/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/aarch64/glibc/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/scarthgap/arm/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/arm/glibc/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/scarthgap/riscv/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/riscv/glibc/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/scarthgap/x86-64/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/x86-64/glibc/143.0.4/test) |
| Walnascar - 140.3.1esr | ![](https://sarvari.me/meta-browser/badges/walnascar/aarch64/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/aarch64/glibc/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/walnascar/arm/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/arm/glibc/140.3.1esr/test) |![](https://sarvari.me/meta-browser/badges/walnascar/riscv/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/riscv/glibc/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/walnascar/x86-64/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/x86-64/glibc/140.3.1esr/test) |
| Walnascar - 143.0.4 | ![](https://sarvari.me/meta-browser/badges/walnascar/aarch64/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/aarch64/glibc/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/walnascar/arm/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/arm/glibc/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/walnascar/riscv/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/riscv/glibc/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/walnascar/x86-64/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/x86-64/glibc/143.0.4/test) |
| Master - 140.3.1esr | ![](https://sarvari.me/meta-browser/badges/master/aarch64/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/aarch64/glibc/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/master/arm/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/arm/glibc/140.3.1esr/test) |![](https://sarvari.me/meta-browser/badges/master/riscv/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/riscv/glibc/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/master/x86-64/glibc/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/x86-64/glibc/140.3.1esr/test) |
| Master - 143.0.4 | ![](https://sarvari.me/meta-browser/badges/master/aarch64/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/aarch64/glibc/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/master/arm/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/arm/glibc/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/master/riscv/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/riscv/glibc/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/master/x86-64/glibc/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/x86-64/glibc/143.0.4/test) |


### musl-libc

| x | aarch64 | arm | riscv64 | x86-64 |
| ---- | ---- | ---- | ---- | ---- |
| Kirkstone - 140.3.1esr | ![](https://sarvari.me/meta-browser/badges/kirkstone/aarch64/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/kirkstone/aarch64/musl/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/kirkstone/arm/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/kirkstone/arm/musl/140.3.1esr/test) | N/A | ![](https://sarvari.me/meta-browser/badges/kirkstone/x86-64/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/kirkstone/x86-64/musl/140.3.1esr/test) |
| Kirkstone - 143.0.4 | ![](https://sarvari.me/meta-browser/badges/kirkstone/aarch64/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/kirkstone/aarch64/musl/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/kirkstone/arm/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/kirkstone/arm/musl/143.0.4/test) | N/A | ![](https://sarvari.me/meta-browser/badges/kirkstone/x86-64/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/kirkstone/x86-64/musl/143.0.4/test) |
| Scarthgap - 140.3.1esr | ![](https://sarvari.me/meta-browser/badges/scarthgap/aarch64/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/aarch64/musl/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/scarthgap/arm/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/arm/musl/140.3.1esr/test) |![](https://sarvari.me/meta-browser/badges/scarthgap/riscv/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/riscv/musl/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/scarthgap/x86-64/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/x86-64/musl/140.3.1esr/test) |
| Scarthgap - 143.0.4 | ![](https://sarvari.me/meta-browser/badges/scarthgap/aarch64/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/aarch64/musl/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/scarthgap/arm/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/arm/musl/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/scarthgap/riscv/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/riscv/musl/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/scarthgap/x86-64/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/scarthgap/x86-64/musl/143.0.4/test) |
| Walnascar - 140.3.1esr | ![](https://sarvari.me/meta-browser/badges/walnascar/aarch64/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/aarch64/musl/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/walnascar/arm/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/arm/musl/140.3.1esr/test) |![](https://sarvari.me/meta-browser/badges/walnascar/riscv/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/riscv/musl/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/walnascar/x86-64/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/x86-64/musl/140.3.1esr/test) |
| Walnascar - 143.0.4 | ![](https://sarvari.me/meta-browser/badges/walnascar/aarch64/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/aarch64/musl/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/walnascar/arm/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/arm/musl/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/walnascar/riscv/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/riscv/musl/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/walnascar/x86-64/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/walnascar/x86-64/musl/143.0.4/test) |
| Master - 140.3.1esr | ![](https://sarvari.me/meta-browser/badges/master/aarch64/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/aarch64/musl/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/master/arm/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/arm/musl/140.3.1esr/test) |![](https://sarvari.me/meta-browser/badges/master/riscv/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/riscv/musl/140.3.1esr/test) | ![](https://sarvari.me/meta-browser/badges/master/x86-64/musl/140.3.1esr/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/x86-64/musl/140.3.1esr/test) |
| Master - 143.0.4 | ![](https://sarvari.me/meta-browser/badges/master/aarch64/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/aarch64/musl/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/master/arm/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/arm/musl/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/master/riscv/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/riscv/musl/143.0.4/test) | ![](https://sarvari.me/meta-browser/badges/master/x86-64/musl/143.0.4/build) <br/> ![](https://sarvari.me/meta-browser/badges/master/x86-64/musl/143.0.4/test) |


OpenEmbedded/Yocto BSP layer for Firefox Browser
================================================

This layer provides web browser recipes for use with OpenEmbedded
and/or Yocto.

## Dependencies

This layer depends on oe-core, meta-oe and meta-clang (only pre-Whinlatter). This layer supports 
multiple Yocto releases, the branches should match each other.

Additionally, the Rust version shipped with Kirkstone and Scarthgap oe-core is out of date, 
which can be remediated by other third-party layers: for Kirkstone and Scarthgap version the 
corresponding branch of meta-lts-mixins is required for up to date Rust compiler. Additionally, 
for Kirkstone, meta-rust layer can be used also to get an up-to-date Rust compiler.

For the tested revision/release combinations, see meta-firefox-test repository, especially
the kas folder - that contains all the branch/revision information used for testing.

`meta-clang` layer requires `libstdc++` to be installed on the build machine - make sure to 
install it, in case it is missing  (e.g. on Debian based systems install `libstdc++-dev` or
on Fedora install `libstdc++-devel`)

In case the `disable-sandboxed-libraries` PACKAGECONFIG is not present, then make sure that clang
can compile WebAssembly targets also. In case you get an error like `No available targets are compatible 
with triple "wasm32-unknown-wasi"` while compiling wasi-sdk-native, then make sure to set 
`LLVM_TARGETS_TO_BUILD:append = ";WebAssembly"` in local.conf, or in a bbappend for clang.

Note: Firefox at least Rust 1.82 from version 137. 

When using meta-rust, make sure to add the following to a bbappend or local.conf:

```
# when using a bbappend
RUST_HOST = "${BUILD_SYS}"
RUST_TARGET = "${TARGET_SYS}"

# when using local.conf
RUST_HOST:pn-firefox = "${BUILD_SYS}"
RUST_TARGET:pn-firefox = "${TARGET_SYS}"
```

Due to this, the selection of Rust provider needs some caution.
Testing is performed using the following combinations (the "latest" version should also be able to compile "ESR"):

| Yocto version | Rust version ESR | Rust version latest |
| ---------------- | ----- | ---- |
| Kirkstone | Rust 1.89.0 from meta-lts-mixins (kirkstone/rust branch) | Rust 1.89.0 from meta-lts-mixins (kirkstone/rust branch) |
| Scarthgap | Rust 1.89.0 from meta-lts-mixins (scarthgap/rust branch) | Rust 1.89.0 from meta-lts-mixins (scarthgap/rust branch) |
| Walnascar | Rust 1.84.1 from oe-core | Rust 1.84.1 from oe-core |
| Master | Rust 1.89.0 from oe-core | Rust 1.89.0 from oe-core |

Contributing
------------

The preferred way to contribute to this layer is to send GitHub pull requests or
report problems in GitHub's issue tracker.

Classic patch submissions via email are not accepted for this layer.

Maintainers
-----------
* OldManYellsAtCloud/Gyorgy Sarvari <skandigraun@gmail.com>

Recipes
-------
recipes-browser/firefox:
Firefox browser.

This recipe provides a package for the Firefox web browser.

Two separate recipes are available: one for the latest stable version, and one
for the latest ESR version. To select the one you would like to build, set
the corresponding `PREFERRED_VERSION_firefox` variable in `local.conf` (for example).

recipes-browser/firefox-i10l:
Language packs for Firefox. The default language is English, but installing any
of these packages will make the new language available in the settings menu.

PACKAGECONFIG knobs
-------------------
* alsa: (detected automatically)
  Enable ALSA support to play audio. It will be enabled automatically when
  DISTRO_FEATURES contains "alsa". Note that Firefox's default audio backend
  is PulseAudio, not ALSA. Although it's not enabled in official build, we
  enable it by default to make easy to play audio without additional daemons.
  When PulseAudio is running, it will be used instead of using ALSA directly
  even if this config is specified.

* wayland: (detected automatically)
  Enable wayland support. It will be enabled automatically when DISTRO_FEATURES
  contains "wayland".

* gpu: (off by default)
  Enable GPU acceleration.

* openmax: (off by default)
  Enable OpenMAX IL decoder to play H.264 video.
  This features is confirmed only on Renesas RZ/G1. Note: it is untested with version 113+.

* webgl: (off by default)
  Firefox on Linux doesn't enable WebGL against most GPUs by default. This
  option adds a config file to enable it forcedly.

* forbid-multiple-compositors: (off by default)
  This option allows to create only one GPU accelerated compositor, second and
  the following windows will use basic compositors. Multiple compositor may
  cause crash on platforms that doesn't support multiple EGL windows.

* disable-sandboxed-libraries: (off by default)
  By default WASM libraries are sandboxed for security purposes, however that can
  introduce quite a big build-time overhead due to extra dependencies.
  Setting this disallows sandboxing these libraries, and removes the wasi-sdk dependency.

* disable-gecko-profiler: (on by default)
  Disable collecting profile statistics in different components of the browser. Reduces
  resource and size footprint (though not drastically).

* rust-simd: (on by default)
  Enable explicit SIMD in Rust code, when supported by the CPU.

* wayland-only: (off by default)
  Don't build Firefox with X11 dependencies. This config should not be enabled if x11-only
  is enabled.

* x11-only: (off by default)
  Don't build Firefox with Wayland dependencies. This config should not be enable if wayland-only
  is enabled.

* system-av1: (off by default)
  Use system av1. Requires minimum aom v3.10 (Walnascar contains only 3.7)

* system-nspr: (off by default and autodetected in some cases)
  Use NSPR from the operating system, instead of building it with Firefox. In case an ARM CPU
  is the target without cryptographic capabilities, this config is automatically enabled.

* system-nss: (off by default and autodetected in some cases)
  Use NSS from the operating system, instead of building it with Firefox. In case an ARM CPU
  is the target without cryptographic capabilities, this config is automatically enabled.

* system-ffi: (off by default)
  Use system libffi

* system-icu: (off by default)
  Use system ICU.

* system-zlib: (off by default)
  Use system libz.

* system-pixman: (off by default)
  Use system pixman.

* system-jpeg: (off by default)
  Use system libjpeg.

* system-libevent: (off by default)
  Use system libevent.

* system-libvpx: (off by default)
  Use system libvpx.

* system-png: (off by default)
  Use system libpng (APNG support is required).

* system-webp: (off by default)
  Use system libwebp.

* system-pipewire: (off by default)
  Use system pipewire.

* system-gbm: (off by default)
  Use system GBM

* system-libdrm: (off by default)
  Use system libdrm

